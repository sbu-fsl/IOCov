# IOCov scripts: parser and plotter

## Workflow

Basically, the workflow of IOCov includes tracing, parsing, and plotting.

- Tracing: tracing methods depend on the file system testers.  We use 
    - `xfstests` and `CrashMonkey`: LTTng
    - `MCFS`: own MCFS logs 
    - `Syzkaller`: Syzkaller's [Syscall descriptions](https://github.com/google/syzkaller/blob/master/docs/syscall_descriptions.md). Download webpages of Syzkaller.
- Parsing: transforming raw syscall logs to pickle files with dictionaries that contain input/output partitions.
- Plotting: visualization of input and output coverage. 

## Usage

The main entry of the parser and plotter is `iocov-main.py`.  The 
first step is parsing the logs from LTTng, while parsing Syzkaller
webpages need the scripts in the `../Syzkaller`.  To parse LTTng logs,
we should edit three fields in the `iocov-main.py`: `default_plot_name`,
`default_is_mcfs`, and `default_lttng_log`.

- `default_plot_name`: suffix for the pkl and json file names.  For 
  example, `default_plot_name = 'xfstests_xattr_open_dump'` indicates that 
  IOCov will write the parsed input and output coverage to `input_cov_xfstests_xattr_open_dump.pkl`,
  `output_cov_xfstests_xattr_open_dump.pkl` and `unfilter_input_cov_xfstests_xattr_open_dump.pkl`.
  Meanwhile, IOCov looks for these pickle files (i.e., `input_cov_xfstests_xattr_open_dump.pkl`)
  and load them to plot corresponding figures for input and output coverage.
  `default_plot_name` is also the suffix of plot titles by replacing `_`
  with space ` ` (i.e., `replace('_', ' ')`) and the prefix of intermediate 
  pkl files generated by IOCov plotter --- we can expect the  `xfstests_xattr_open_dump_input_coords.pkl`
  and `xfstests_xattr_open_dump_output_coords.pkl` as the X/Y-axis data pickled 
  by the plotter.  Finally, `default_plot_name` serves as the prefix of 
  the file name of PDF plots where file names format as `prefix-input-syscall-param.pdf`. 
  Python code for plot file name:`'{}-input-{}-{}.{}'.format(self.plot_prefix, sc, param, self.plot_format)`
- `default_is_mcfs`: boolean variable to specify if we are processing 
  input and output coverage for MCFS.  `True` means MCFS.  `is_mcfs` 
  is required by IOCov parser because MCFS needs to be handled specially.
- `default_lttng_log`: pathname to the LTTng log file.  For example,
  `default_lttng_log = xfstests-lttng-all-related-ext4-all-xattrs-4633.log`
  is passed to IOCov parser so IOCov reads this log line by line and 
  parse the information to obtain the dictionary (pkl/json files) for 
  further analysis and plotting. 

After editting these global variables, we run the following command to execute 
IOCov parser if parsing is required:

```bash
python3 iocov-main.py --parse
```

When we only have the pickle files for the parsed input/output coverage
but no json file exists, 
we run the following command to produce corresponding json files:

```bash
python3 iocov-main.py --no-parse --json
```

If the input/output coverage is already parsed (pkl files are available),
we run IOCov plotter to get the plots to visualize input and output coverage 
for various syscalls and arguments/returns:

```bash
python3 iocov-main.py --no-parse --plot
```

Run the following command to also plot unfiltered input coverage with a 
stacked bar plot format:

```bash
python3 iocov-main.py --no-parse --plot --plotunfilter
```

Run the following command to plot input coverage only:

```bash
python3 iocov-main.py --no-parse --plot -i
```

Run the following command to plot output coverage only:

```bash
python3 iocov-main.py --no-parse --plot -o
```

The generated plots (PDF files) are stored to the `./Assets/Input-Figures`
and `./Assets/Output-Figures` directories.

## Syzkaller

Parsing Syzkaller syscalls is documented at [README](../Syzkaller/README.md).

